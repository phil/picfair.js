<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Picfair.js</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>

      // https://www.picfair.com/pics/91501382-positano-italy

      // Thumbnail
      // <img alt="Bp7jigk4mvyy3lecjr2p"
      // src="http://res.cloudinary.com/fleetnation/image/private/c_fill,g_center,h_640,w_640/v1418070939/bp7jigk4mvyy3lecjr2p.jpg">

      // Main Pic
      // <img alt="Bp7jigk4mvyy3lecjr2p"
      // src="http://res.cloudinary.com/fleetnation/image/private/c_fit,w_1120/g_south,l_text:style_gothic2:©
      // Phil
      // Balchin,o_20,y_10/g_center,l_watermark4,o_25,y_50/v1418070939/bp7jigk4mvyy3lecjr2p.jpg">

      // URLS for images
      // http://res.cloudinary.com/fleetnation/image/private/c_fill,g_center,h_640,w_640/ v1418070939/bp7jigk4mvyy3lecjr2p.jpg
      // http://res.cloudinary.com/fleetnation/image/private/c_fit,w_1120/g_south,l_text:style_gothic2:© Phil Balchin,o_20,y_10/g_center,l_watermark4,o_25,y_50/ v1418070939/bp7jigk4mvyy3lecjr2p.jpg

      //      function linkToPicfairURL(url){
      //        $.get(url, function( data ) {
      //          console.log(data.match(\title(.*)title\));
      //            //$( ".result" ).html( data );
      //            //alert( "Load was performed." );
      //        });
      //
      //        //return,c url;
      //      }

      $(document).ready(function(){
        console.log("Document Ready");
        $("[data-picfair]").picfair();
      });

function PicfairPhoto(url, callback) {
  console.log("PicfairPhoto: " + url);

  this.url = url;
  this.photoID = "";
  this.title = "";
  this.price = "";

  this.starred = false;

  this.img = "";
  this.mainPhotoURL = "";
  this.thumbPhotoURL = "";

  console.log("Title: " + this.title);
  console.log("Price: " + this.price);

  var titleExpr = new RegExp("<div class='captiontitle'>[^]+?<h3>([^]+?)<\/h3>", "i");
  var priceExpr = new RegExp("<span class=\"price\">&pound;([0-9.]+?)<\/span>", "i");
  var imageMainExpr = new RegExp("<div class='thepicture[^]+?(<img[^]+?>)");

  jQuery.get(url, function( data ) {

    this.price = data.match(priceExpr)[1];
    this.title = data.match(titleExpr)[1];
    this.img = data.match(imageMainExpr)[1];

    callback(this);

  });
}

$.fn.picfair = function(){
  return this.each(function(){

    var div = $(this);
    //div.append('NEW TXT!!');

    var titleElement = $('<div class="picfair-title"></div>');
    div.append(titleElement);

    var priceElement = $('<div class="picfair-price"></div>');
    div.append(priceElement);

    var picfairPhoto = new PicfairPhoto($(this).data("picfair"), function(photo){
      console.log("FINAL callback");
      div.append(photo.img);
      titleElement.append(photo.title);
      priceElement.append(photo.price);
    });

  });
}

function sanitizeText(text){
  return text.replace(/\r\n|\r|\n/gi, "");
}


    </script>
  </head>

  <body>

    <h1>Picfair.js</h1>

    <p>A collection of tools to help integrate with <a href="http://www.picfair.com">Picfair.com</a></p>

    <h2>Displaying and Linking to Picfair Pages</h2>

    <div data-picfair="https://www.picfair.com/pics/91501382-positano-italy">
      A Bit More Text
    </div>

    <div data-picfair="https://www.picfair.com/pics/91501915-golden-hour-sunshine"></div>
    <div data-picfair="https://www.picfair.com/pics/balloon-takeoff"></div>

  </body>
</html>
